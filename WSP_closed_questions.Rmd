---
title: "WSP closed question analysis"
author: "Lizzie Jones^[University of Brighton, l.jones4@brighton.ac.uk]"
date: "10/05/2021"
output:
  html_document:
    number_sections: no
  pdf_document:
    number_sections: no
  word_document: default
---


## WSP - Analysis, stats and visualisations for closed questions


This rMarkdown explores and analyses the closed 

### About rMarkdowns

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>. To generate the document of all content, click the **Knit** button. 

This rMarkdown document will be periodically updated and uploaded to the OneDrive folder and pushed to the WSP GitHub code repository. The primary format of this document is HTML, but this can be easily changed by changing the output (e.g. PDF, GitHub) using the 'output' section at the top of the document. The possible output formats are listed here: https://rmarkdown.rstudio.com/lesson-9.html.


```{r setup/packages, include=FALSE}
# This code assumes that all packages are installed. If not, use 'install.packages' e.g. install.packages("likert")

# Key packages for data wrangling
wrangling <- c("dplyr","tidyverse","purr","magrittr","lubridate","hms",
             "data.table","plyr","tidyr","tibble","reshape2")
lapply(wrangling, require, character.only = TRUE) 

# Useful survey analysis packages
survey <- c("likert","careless")
lapply(survey, require, character.only = TRUE) 

# Useful packages for statistics
stats <- c("stats","ggpubr","lme4","MASS","car","psych",
                   "MuMIn","glmmTMB","nlme","DHARMa")
lapply(stats, require, character.only = TRUE) 

# Favourite data visualisation packages
vismap <- c("ggvis","htmlwidgets","maps", "lattice","ggmap","ggplot2","plotly","rnaturalearth",
            "RColorBrewer", "sjPlot", "ggrepel", "rgdal", "maptools", "gpclib")
lapply(vismap, require, character.only = TRUE) 
gpclibPermit()  # Gives maptool permission to use gpclib

```

```{r setwd and dataframes, include=FALSE}
# Load in working  directory and datasets
setwd("~/Documents/White-Stork-Project")
# Load in the data
original_data <- read.csv("Stork_MainDataset.csv", header = TRUE, stringsAsFactors=TRUE)
all_data <- read.csv("Stork_Dataset_Radapted.csv", header = TRUE, stringsAsFactors=TRUE)

# Load in cleaned dataset
final_data <- read.csv("WSP_R_cleaned_dataset_Final.csv", header = TRUE, stringsAsFactors=TRUE)
# View cleaned dataset
nrow(final_data)

# Define ReleaseSite and SiteProximity columns
summary(final_data$ReleaseSite)
final_data <- final_data %>% 
            mutate(SiteProximity = if_else(ReleaseSite == "No", 'No', 'Yes'))
final_data <- final_data %>% 
          sjmisc::move_columns(SiteProximity, .after = "ReleaseSite")
summary(final_data$SiteProximity)

### Create two dataframes: one for each data collection (Proactive survey and Nationally representative survey) for easier comparison
proact_data <- final_data[which(final_data$SurveyType == "Proactive"),]
natrep_data <- final_data[which(final_data$SurveyType == "NatRep"),]


```

```{r column groups, include=FALSE}

### Grouping columns
# Grouping Likert scale question columns by selecting Question numbers (and dropping scores or open questions)
overall_score_colnames <- dplyr::select(final_data, ends_with("overallscore"))

Q4_knowledge_colnames <- dplyr::select(final_data, starts_with("Q4"),
                                       -ends_with('score'))
Q5_diet_colnames <- dplyr::select(final_data, starts_with("Q5"))
Q6_habitat_colnames <- dplyr::select(final_data, starts_with("Q6"))
Q7_nesting_colnames <- dplyr::select(final_data, ends_with("nesting"))

Q8_seen_colnames <- dplyr::select(final_data, starts_with("Q8_"))

# Source of information (current and preferred)
Q10_cursource_colnames <- dplyr::select(final_data, starts_with("Q10a"))
Q10_prefsource_colnames <- dplyr::select(final_data, starts_with("Q10b"))

# Q12-14 = attitudes to white storks
all_attitude_colnames <- dplyr::select(final_data, starts_with("Q13"),
                             starts_with("Q13"), starts_with("Q14"),
                             -ends_with('score'))
Q12_attitude_colnames <- dplyr::select(final_data, starts_with("Q12"),
                                       -ends_with('score'))
Q13_attitude_colnames <- dplyr::select(final_data, starts_with("Q13"),
                                       -ends_with('score'))
Q14_attitude_colnames <- dplyr::select(final_data, starts_with("Q14"),
                                       -ends_with('score'))

## Q15 = WSP support
## Q16 = Views on current management
Q17_management_colnames <- dplyr::select(final_data, starts_with("Q17"),
                                         -ends_with('open'))
Q18_exp_colnames <- dplyr::select(final_data, starts_with("Q18_"),
                                  -ends_with('open')) # Frequency of
Q19_NCI_colnames <- dplyr::select(final_data, starts_with("Q19"),
                                  -ends_with('score')) # Q19 total score = NCI
Q20_envconcern_colnames <- dplyr::select(final_data, starts_with("Q20"),
                                         -ends_with('score')) # Q21 total score = Env.concern score
Q21_ProCoBS_colnames <- dplyr::select(final_data, starts_with("Q21"),
                                      -ends_with('score')) # Q21 total score = ProCoBS
Q23_BIS_colnames <- dplyr::select(final_data, starts_with("Q23"),
                                  -ends_with('score')) # Q23 total score = BirdInterestScore

```


## Sectioned analysis (in order found in questionnaire)

### Respondent knowledge

Respondent knowledge questions have yes/no/notsure or incorrect/correct answer formats, lending themselves to Likert or Stacked bar plot style plots. Below I have created some initial plots, seperated according to sample type and started calculating sample sizes per question to create a tableto display the sample sizes per column, per survey type.

Some useful Likert plotting guides and packages:
* https://cran.r-project.org/web/packages/sjPlot/vignettes/plot_likert_scales.html
* https://towardsdatascience.com/how-to-plot-likert-scales-with-a-weighted-survey-in-a-dplyr-friendly-way-68df600881a 
* https://www.r-graph-gallery.com/202-barplot-for-likert-type-items.html


```{r Q2 photo recog, echo=TRUE, messages=FALSE}

### Calculating sample sizes for knowledge questions table

# Selecting image of WS
final_data %>%
  dplyr::select(SurveyType, Q2_photo_recog_score, Q2_photo_recog) %>% 
  dplyr::group_by(SurveyType, Q2_photo_recog) %>% 
  summarise(n = n()) %>%
  mutate(Percent = (n / sum(n)*100)) 

```



```{r Q3 Knowledge questions, echo=FALSE, messages=FALSE}

str(final_data$Q3_is_native)
final_data$Q3_is_native = as.factor(final_data$Q3_is_native)

# Sample sizes: Q3. Are WS native?
final_data %>%
  dplyr::select(SurveyType, Q3_is_native) %>% 
  dplyr::group_by(SurveyType, Q3_is_native) %>% 
  summarise(n = n()) %>%
  mutate(Percent = (n / sum(n)*100)) 


```



```{r Q4 Knowledge questions, echo=FALSE, messages=FALSE}

knowl_cols <- c("Q4.1_migrate_score", "Q4.2_wingspan_score", "Q4.3_globallyrare_score")
### White stork knowledge
final_data <- final_data %<>% mutate_at(knowl_cols, funs(factor(.)))
# Select the columns and convert to Likert data using the 'Likert' package
Q4_knowledge_scores <- final_data[knowl_cols]
Q4_knowledge_results = likert(Q4_knowledge_scores)
# summary(Q4_knowledge_results)
plot(Q4_knowledge_results, type="bar")

# Migrate (yes/no)
final_data %>%
  dplyr::select(SurveyType, Q4.1_migrate_score, Q4.1_migrate) %>% 
  dplyr::group_by(SurveyType, Q4.1_migrate) %>% 
  summarise(n = n()) %>%
  mutate(Percent = (n / sum(n)*100)) 

# Wingspan (yes/no)
final_data %>%
  dplyr::select(SurveyType, Q4.2_wingspan_score, Q4.2_wingspan) %>% 
  dplyr::group_by(SurveyType, Q4.2_wingspan) %>% 
  summarise(n = n()) %>%
  mutate(Percent = (n / sum(n)*100)) 

# Globally rare (yes/no)
final_data %>%
  dplyr::select(SurveyType, Q4.3_globallyrare_score, Q4.3_globallyrare) %>% 
  dplyr::group_by(SurveyType, Q4.3_globallyrare) %>% 
  summarise(n = n()) %>%
  mutate(Percent = (n / sum(n)*100)) 

```




```{r Q5 diet questions, echo=FALSE, messages=FALSE}

colnames(final_data)
# Create list of diet columns names for easier factorsation and labelling
diet_cols <- c("Q5a_amphibians_diet","Q5b_birdeggs.chicks_diet","Q5c_carrion_diet","Q5d_fish_diet",
              "Q5e_foodwaste_diet","Q5f_fruit_diet","Q5g_inverts_diet","Q5h_reptiles_diet","Q5i_seeds_diet",
              "Q5j_smallmammals_diet","Q5k_vegetation_diet","Q5l_Don.tKnow_diet")
final_data %<>% 
  mutate_at(diet_cols, funs(factor(.,
            levels = c("0", "1"), labels = c("Incorrect", "Correct"), ordered = TRUE)))
# Select the columns and convert to Likert data using the 'Likert' package
Q5_diet_colnames <- final_data[diet_cols]
Q5_diet_colnames$SurveyType <- final_data$SurveyType
# GGplot example
diet_counts = Q5_diet_colnames%>%
    gather(key = Diet, value = Answer, -SurveyType) %>%
    group_by(SurveyType, Diet, Answer) %>%
    summarise(count = length(Answer)) %>% 
    mutate(percent = count / sum(count) * 100) %>% 
    filter(., Answer == "Correct")
    # dplyr::select(-count)
diet_counts
```

```{r Q6 habitat questions, echo=FALSE, messages=FALSE}
head(final_data$Q6a_farmland_habitat)
# Create list of diet columns names for easier factorsation and labelling
habitat_cols <- c("Q6a_farmland_habitat", "Q6b_grassland_habitat","Q6c_wetlands_habitat","Q6d_woodland_habitat",                                                              "Q6e_urban_habitat","Q6f_Don.tKnow_habitat")
final_data %<>% mutate_at(habitat_cols, funs(factor(.,
                       levels = c("0", "1"), labels = c("No", "Yes"), ordered = TRUE)))
# Select the columns and convert to Likert data using the 'Likert' package
Q6_habitat_cols <- final_data[habitat_cols]
Q6_habitat_cols$SurveyType <- final_data$SurveyType
# GGplot example
Habitat_counts = Q6_habitat_cols %>%
    gather(key = Habitat, value = Answer, -SurveyType) %>%
    group_by(SurveyType, Habitat, Answer) %>%
    summarise(count = length(Answer)) %>% 
    mutate(percent = count / sum(count) * 100) %>% 
    filter(., Answer == "Yes")
    # dplyr::select(-count)
Habitat_counts

```


```{r Q7 nesting questions, echo=FALSE, messages=FALSE}
# head(final_data$Q7a_chimneys_nesting)
# Create list of diet columns names for easier factorsation and labelling
nest_cols <- c("Q7a_chimneys_nesting","Q7b_ground_nesting","Q7c_roofs_nesting",
                  "Q7d_telegraphpoles_nesting","Q7e_trees_nesting","Q7f_Don.tKnow_nesting")
final_data %<>% mutate_at(nest_cols, funs(factor(.,
                       levels = c("0", "1"), labels = c("No", "Yes"), ordered = TRUE)))
# str(final_data[nest_cols])
# Select the columns and convert to Likert data using the 'Likert' package
Q7_nesting_cols <- final_data[nest_cols]
Q7_nesting_cols$SurveyType <- final_data$SurveyType
# GGplot example
nest_counts = Q7_nesting_cols %>%
    gather(key = Nest, value = Answer, -SurveyType) %>%
    group_by(SurveyType, Nest, Answer) %>%
    summarise(count = length(Answer)) %>% 
    mutate(percent = count / sum(count) * 100) %>% 
    filter(., Answer == "Yes")
    # dplyr::select(-count)
nest_counts

```


## Exploring perceptions questions


```{r Q3 where seen, echo=FALSE, messages=FALSE, warning=FALSE}

str(final_data$Q8.WhereSeen)

# Sample sizes: Q8. Where have you seen a WS?
final_data %>%
  dplyr::select(SurveyType, Q8.WhereSeen) %>% 
  dplyr::group_by(SurveyType, Q8.WhereSeen) %>% 
  summarise(n = n()) %>%
  mutate(Percent = (n / sum(n)*100)) 


```

